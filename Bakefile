
COFFEE="node_modules/.bin/coffee"
JASMINE="node_modules/.bin/jasmine-node"
LESS="node_modules/.bin/lessc"
INLINER="node_modules/.bin/inliner"

# print a dot -- for progress
dot() {
  echo -n .
}

bake_compile() {
  invoke "compile:css"
  invoke "compile:js"
  invoke "compile:html"
  invoke "compile:images"
  echo
}

bake_compile:css() {
  dot; mkdir -p tmp/css
  dot; $LESS src/less/main.less > tmp/css/main.css
}

bake_compile:js() {
  dot; mkdir -p tmp/js
  for src in command sites app; do
    dot; $COFFEE -o tmp/js -c src/coffee/$src.coffee
  done
}

bake_compile:images() {
  dot; mkdir -p tmp/images
  dot; cp src/images/logo.jpg tmp/images/
}

bake_compile:html() {
  dot; coffee tools/extract_sites.coffee > src/html/sites.part

  dot; sed '/include: sites.part/ {
    r src/html/sites.part
    d
  }' src/html/index.html > tmp/index.html
}

bake_clean() {
  if [ -d tmp ]; then
    rm -rf tmp
  fi
}

bake_spec() {
  invoke "compile:js"
  echo
  $JASMINE --coffee spec
}

bake_inline() {
  invoke "compile"
  $INLINER --nocompress --verbose http://localhost:8000/index.html > public/index.html
}

